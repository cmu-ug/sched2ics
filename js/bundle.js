(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){window.node_cal=require("node-cal")},{"node-cal":2}],2:[function(require,module,exports){"use strict";module.exports=require("./src/node-cal.js")},{"./src/node-cal.js":5}],3:[function(require,module,exports){"use strict";var calEvent=require("./event.js");var util=require("./util.js");var exports=module.exports={};function Calendar(name,desc){if(name==null)return null;this.prodid="-//node-cal//"+name+"//EN";this.name=name;this.desc=desc;this.events=[]}Calendar.prototype.addEvent=function(event){if(util.isValidEvent(event)){this.events.push(event)}else{throw"Invalid event!"}};Calendar.prototype.addRecurringEvent=function(event){if(util.isValidRecurringEvent(event)){var timeDiff=Math.abs(event.event.endDate.getTime()-event.event.startDate.getTime());var diffDays=Math.ceil(timeDiff/(1e3*3600*24));var startDate=event.event.startDate;var currDate=new Date(event.event.startDate);for(var i=0;i<=diffDays;i++){if(event.testFunc(startDate,currDate)){var tempEvent=new calEvent.CalEvent(event.event.summary,new Date(currDate),new Date(currDate.getTime()+event.eventLength),event.event.alarms,event.event.description,event.event.location);this.events.push(tempEvent)}currDate.setDate(currDate.getDate()+1)}}else{throw"Invalid recurring event!"}};Calendar.prototype.toICal=function(url){var serialized,len,event;len=this.events.length;serialized="BEGIN:VCALENDAR\n"+"VERSION:2.0\n"+"CALSCALE:GREGORIAN\n"+"METHOD:PUBLISH\n";serialized+="PRODID:"+this.prodid+"\n";serialized+="URL:"+(url==null?"":url)+"\n";serialized+="NAME:"+this.name+"\n";serialized+="X-WR-CALNAME:"+this.name+"\n";serialized+="DESCRIPTION:"+(this.desc==null?"":this.desc)+"\n";serialized+="X-WR-CALDESC:"+(this.desc==null?"":this.desc)+"\n";for(var i=0;i<len;i++){event=this.events[i];serialized+="BEGIN:VEVENT\n";serialized+="UID:"+event.uid+"\n";serialized+="SUMMARY:"+util.makeSafe(event.summary,true)+"\n";if(event.description)serialized+="DESCRIPTION:"+util.makeSafe(event.description,true)+"\n";serialized+="CLASS:PUBLIC\n";serialized+="DTSTART:"+util.dateToStr(event.startDate)+"\n";serialized+="DTEND:"+util.dateToStr(event.endDate)+"\n";if(event.location)serialized+="LOCATION:"+util.makeSafe(event.location,true)+"\n";for(var j=0;j<event.alarms.length;j++){serialized+="BEGIN:VALARM\n";serialized+="TRIGGER:-"+util.secondsToDuration(event.alarms[j])+"\n";serialized+="ACTION:DISPLAY\n";serialized+="DESCRIPTION:Reminder\n";serialized+="END:VALARM\n"}serialized+="END:VEVENT\n"}serialized+="END:VCALENDAR";return serialized};Calendar.prototype.toJSON=function(){var json,len;len=this.events.length;json="{\n";json+='"prodid" : "'+this.prodid+'",\n';json+='"name" : "'+this.name+'",\n';json+='"desc" : "'+(this.desc==null?"":this.desc)+'",\n';json+='"events" : [\n';for(var i=0;i<len;i++){json+=this.events[i].toJSON()+",\n"}json=json.slice(0,-2);json+="]\n}";return json};var calFromJSON=function(json){if(json==null)return null;try{var keys=JSON.parse(json);var newCal=new Calendar(keys["name"],keys["desc"]);var eA=keys["events"];var lenEA=eA.length;newCal.prodid=keys["prodid"];for(var i=0;i<lenEA;i++){newCal.addEvent(new calEvent.CalEvent(eA[i]["summary"],new Date(eA[i]["startDate"]),new Date(eA[i]["endDate"]),eA[i]["alarms"],eA[i]["description"],eA[i]["location"],eA[i]["uid"]))}return newCal}catch(e){return null}};exports.Calendar=Calendar;exports.calFromJSON=calFromJSON},{"./event.js":4,"./util.js":6}],4:[function(require,module,exports){"use strict";var util=require("./util.js");var exports=module.exports={};function CalEvent(name,startDate,endDate,alarms,description,location,uid){if(startDate instanceof Date){this.startDate=startDate}else{return null}if(endDate instanceof Date){this.endDate=endDate}else{return null}this.alarms=alarms;this.uid=uid==null?util.guid()+"@node-cal-event.js":uid;this.summary=name;this.location=location;this.description=description}function RepeatingCalEvent(event,eventLength,testFunc){if(!util.isValidEvent(event))return null;if(eventLength==null)eventLength=0;if(testFunc==null)return null;this.event=event;this.eventLength=eventLength;this.testFunc=testFunc}var repeatWeekly=function(startDate,date){var timeDiff=Math.abs(date.getTime()-startDate.getTime());var diffDays=Math.ceil(timeDiff/(1e3*3600*24));return diffDays%7==0};CalEvent.prototype.toJSON=function(){var json;json="{";json+='"uid" : "'+util.makeSafe(this.uid)+'",\n';json+='"summary" : "'+util.makeSafe(this.summary)+'",\n';json+='"location" : "'+util.makeSafe(this.location==null?"":this.location)+'",\n';json+='"description" : "'+util.makeSafe(this.description==null?"":this.description)+'",\n';json+='"startDate" : "'+this.startDate.toISOString()+'",\n';json+='"endDate" : "'+this.endDate.toISOString()+'",\n';json+='"alarms" : '+JSON.stringify(this.alarms)+"\n";json+="}";return json};var eventFromJSON=function(json){if(json==null)return null;try{var keys=JSON.parse(json);return new CalEvent(keys["summary"],new Date(keys["startDate"]),new Date(keys["endDate"]),keys["alarms"],keys["description"],keys["location"],keys["uid"])}catch(e){return null}};exports.CalEvent=CalEvent;exports.RepeatingCalEvent=RepeatingCalEvent;exports.repeatWeekly=repeatWeekly;exports.eventFromJSON=eventFromJSON},{"./util.js":6}],5:[function(require,module,exports){"use strict";var exports=module.exports={};var event=require("./event.js");var cal=require("./calendar.js");exports.CalEvent=event.CalEvent;exports.RepeatingCalEvent=event.RepeatingCalEvent;exports.Calendar=cal.Calendar;exports.calFromJSON=cal.calFromJSON;exports.repeatWeekly=event.repeatWeekly;exports.eventFromJSON=event.eventFromJSON},{"./calendar.js":3,"./event.js":4}],6:[function(require,module,exports){"use strict";var CalEvent=require("./event.js").CalEvent;var exports=module.exports={};function guid(){function s4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()}function isValidEvent(event){try{if(event.uid==null)return false;if(event.summary==null)return false;if(event.startDate==null)return false;if(event.endDate==null)return false;return true}catch(e){return false}}function isValidRecurringEvent(event){try{if(!isValidEvent(event.event))return false;if(event.testFunc==null)return false;return true}catch(e){return false}}function dateToStr(date){var icsDate=date.toISOString();icsDate=icsDate.substring(0,icsDate.indexOf("."));icsDate+="Z";icsDate=icsDate.replace(/-/g,"");icsDate=icsDate.replace(/:/g,"");return icsDate}function makeSafe(str,isICS){if(isICS){str=str.replace(/,/g,"\\,").replace(/;/g,"\\;")}return str.replace(/\n/g,"\\n").replace(/\"/g,'\\"').replace(/\r/g,"\\r").replace(/\t/g,"\\t")}function makeUnsafe(str){return str.replace(/\\n/g,"\n").replace(/\\\"/g,'"').replace(/\\r/g,"\r").replace(/\\,/g,",").replace(/\\;/g,";").replace(/\\t/g,"\t")}function secondsToDuration(seconds){var str="P";var days=Math.floor(seconds/86400);if(seconds==0){return str+"T0S"}if(days>0){str+=days;str+="D";seconds-=days*86400}str+="T";var hours=Math.floor(seconds/3600);if(hours>0){str+=hours;str+="H";seconds-=hours*3600}var minutes=Math.floor(seconds/60);if(minutes>0){str+=minutes;str+="M";seconds-=minutes*60}if(seconds>0){str+=seconds;str+="S"}return str}exports.guid=guid;exports.dateToStr=dateToStr;exports.isValidEvent=isValidEvent;exports.isValidRecurringEvent=isValidRecurringEvent;exports.makeSafe=makeSafe;exports.makeUnsafe=makeUnsafe;exports.secondsToDuration=secondsToDuration},{"./event.js":4}]},{},[1]);
